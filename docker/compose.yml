services:
  ugv_ros:
    build:
      context: ..
      dockerfile: docker/Dockerfile
    network_mode: host
    ipc: host
    pid: host
    privileged: true
    environment:
      - ROS_DOMAIN_ID=${ROS_DOMAIN_ID}
      - UGV_SERIAL_PORT=${UGV_SERIAL_PORT}
      - UGV_SERIAL_BAUD=${UGV_SERIAL_BAUD}
      - UGV_CAMERA_DEVICE=${UGV_CAMERA_DEVICE}
      - UGV_CAMERA_FPS=${UGV_CAMERA_FPS}
      - UGV_CAMERA_WIDTH=${UGV_CAMERA_WIDTH}
      - UGV_CAMERA_HEIGHT=${UGV_CAMERA_HEIGHT}
      - UGV_MISSION_ROOT=${UGV_MISSION_ROOT}
      - NAS_HOST=${NAS_HOST}
      - NAS_USER=${NAS_USER}
      - NAS_DEST_DIR=${NAS_DEST_DIR}
    volumes:
      - ../ros2_ws:/work/ros2_ws:rw
      - ${UGV_MISSION_ROOT}:${UGV_MISSION_ROOT}:rw
      - /dev:/dev
    command: >
      bash -lc "
        cd /work/ros2_ws &&
        colcon build --symlink-install &&
        source install/setup.bash &&
        ros2 launch ugv_rover_pt_bringup bringup.launch.py
      "
    restart: unless-stopped
